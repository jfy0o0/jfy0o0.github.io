<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="Jiang .">
  
  
  
  <link rel="prev" href="https://jfy0o0.github.io/2021/linux-errno/" />
  <link rel="next" href="https://jfy0o0.github.io/2021/elementary-knowledge-%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/" />
  <link rel="canonical" href="https://jfy0o0.github.io/2021/linux-note/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           Linux - note | Jiang . &#39;s blog
       
  </title>
  <meta name="title" content="Linux - note | Jiang . &#39;s blog">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/jfy0o0.github.io"
    },
    "articleSection" : "posts",
    "name" : "Linux - note",
    "headline" : "Linux - note",
    "description" : "fd 1.所有进程允许打开的最大fd数量 cat \/proc\/sys\/fs\/file-max 2.所有进程已经打开的fd数量及允许的最大数量 \/proc\/sys\/fs\/file-nr 3.单个进程允许打开的最大fd数量 ulimit -n 4.单个进程（例如进程id为5454）已经打开的fd ls -l \/proc\/5454\/fd\/ \/proc\/[pid] cmdline \/proc\/[pid]\/cmdline 是一个只读文件，包含进程的完整命令行信息。如果该进程已经被交换出内存或者这个进程是 zombie 进程，则这个文件没有任何内容\nexe \/proc\/[pid]\/exe 为实际运行程序的符号链接。举例如下：\n$ ls -lt \/proc\/2406\/exe lrwxrwxrwx 1 root root 0 Dec 11 19:00 \/proc\/2406\/exe -\u0026gt; \/usr\/bin\/frps fd fd 是一个目录，包含进程打开文件的情况。举例如下：\n$ ls -lt \/proc\/2406\/fd lrwx------ 1 root root 64 Dec 24 09:39 77 -\u0026gt; socket:[44377722] lrwx------ 1 root root 64 Dec 17 15:07 47 -\u0026gt; socket:[29482617] lr-x------ 1 root root 64 Dec 12 20:18 0 -\u0026gt; pipe:[13282] l-wx------ 1 root root 64 Dec 12 20:18 1 -\u0026gt; pipe:[13283] lrwx------ 1 root root 64 Dec 12 20:18 10 -\u0026gt; socket:[12238218] lrwx------ 1 root root 64 Dec 12 20:18 4 -\u0026gt; anon_inode:[eventpoll] lrwx------ 1 root root 64 Dec 12 20:18 40 -\u0026gt; socket:[19378614] status \/proc\/[pid]\/status 包含进程的状态信息。其很多内容与 \/proc\/[pid]\/stat 和 \/proc\/[pid]\/statm 相同，但是却是以一种更清晰地方式展现出来。举例如下：",
    "inLanguage" : "en-us",
    "author" : "Jiang",
    "creator" : "Jiang",
    "publisher": "Jiang",
    "accountablePerson" : "Jiang",
    "copyrightHolder" : "Jiang",
    "copyrightYear" : "2021",
    "datePublished": "2021-07-20 10:19:18 \u002b0800 CST",
    "dateModified" : "2021-07-20 10:19:18 \u002b0800 CST",
    "url" : "https:\/\/jfy0o0.github.io\/2021\/linux-note\/",
    "wordCount" : "386",
    "keywords" : [ "Linux", "Jiang . \u0027s blog"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://jfy0o0.github.io">Jiang . &#39;s blog</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://jfy0o0.github.io">Jiang . &#39;s blog</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Linux - note</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://jfy0o0.github.io" rel="author">Jiang</a> with ♥ 
                <span class="post-time">
                on <time datetime=2021-07-20 itemprop="datePublished">July 20, 2021</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://jfy0o0.github.io/categories/linux/"> Linux </a>
                        
                </span>
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          <h1 id="fd">fd</h1>
<h2 id="1所有进程允许打开的最大fd数量">1.所有进程允许打开的最大fd数量</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cat /proc/sys/fs/file-max
</code></pre></div><h2 id="2所有进程已经打开的fd数量及允许的最大数量">2.所有进程已经打开的fd数量及允许的最大数量</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">/proc/sys/fs/file-nr
</code></pre></div><h2 id="3单个进程允许打开的最大fd数量">3.单个进程允许打开的最大fd数量</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ulimit -n
</code></pre></div><h2 id="4单个进程例如进程id为5454已经打开的fd">4.单个进程（例如进程id为5454）已经打开的fd</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ls -l /proc/5454/fd/
</code></pre></div><h1 id="procpid">/proc/[pid]</h1>
<h2 id="cmdline">cmdline</h2>
<p>/proc/[pid]/cmdline 是一个只读文件，包含进程的完整<a href="https://www.linuxcool.com/">命令</a>行信息。如果该进程已经被交换出内存或者这个进程是 zombie 进程，则这个文件没有任何内容</p>
<h2 id="exe">exe</h2>
<p>/proc/[pid]/exe 为实际运行程序的符号链接。举例如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ ls -lt /proc/2406/exe
lrwxrwxrwx <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">0</span> Dec <span style="color:#ae81ff">11</span> 19:00 /proc/2406/exe -&gt; /usr/bin/frps
</code></pre></div><h2 id="fd-1">fd</h2>
<p>fd 是一个目录，包含进程打开文件的情况。举例如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ ls -lt /proc/2406/fd

lrwx------ <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">64</span> Dec <span style="color:#ae81ff">24</span> 09:39 <span style="color:#ae81ff">77</span> -&gt; socket:<span style="color:#f92672">[</span>44377722<span style="color:#f92672">]</span>
lrwx------ <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">64</span> Dec <span style="color:#ae81ff">17</span> 15:07 <span style="color:#ae81ff">47</span> -&gt; socket:<span style="color:#f92672">[</span>29482617<span style="color:#f92672">]</span>
lr-x------ <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">64</span> Dec <span style="color:#ae81ff">12</span> 20:18 <span style="color:#ae81ff">0</span> -&gt; pipe:<span style="color:#f92672">[</span>13282<span style="color:#f92672">]</span>
l-wx------ <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">64</span> Dec <span style="color:#ae81ff">12</span> 20:18 <span style="color:#ae81ff">1</span> -&gt; pipe:<span style="color:#f92672">[</span>13283<span style="color:#f92672">]</span>
lrwx------ <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">64</span> Dec <span style="color:#ae81ff">12</span> 20:18 <span style="color:#ae81ff">10</span> -&gt; socket:<span style="color:#f92672">[</span>12238218<span style="color:#f92672">]</span>
lrwx------ <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">64</span> Dec <span style="color:#ae81ff">12</span> 20:18 <span style="color:#ae81ff">4</span> -&gt; anon_inode:<span style="color:#f92672">[</span>eventpoll<span style="color:#f92672">]</span>
lrwx------ <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">64</span> Dec <span style="color:#ae81ff">12</span> 20:18 <span style="color:#ae81ff">40</span> -&gt; socket:<span style="color:#f92672">[</span>19378614<span style="color:#f92672">]</span>
</code></pre></div><h2 id="status"><strong>status</strong></h2>
<p>/proc/[pid]/status 包含进程的状态信息。其很多内容与 /proc/[pid]/stat 和 /proc/[pid]/statm 相同，但是却是以一种更清晰地方式展现出来。举例如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cmd" data-lang="cmd">$ cat /proc/2406/status
Name:   frps
State:  S (sleeping)
Tgid:   2406
Ngid:   0
Pid:    2406
PPid:   2130
TracerPid:  0
Uid:    0   0   0   0
Gid:    0   0   0   0
FDSize: 128
Groups: 0
NStgid: 2406
NSpid:  2406
NSpgid: 2406
NSsid:  2130
VmPeak:    54880 kB
VmSize:    54880 kB
VmLck:         0 kB
VmPin:         0 kB
VmHWM:     34872 kB
VmRSS:     10468 kB
VmData:    47896 kB
VmStk:       132 kB
VmExe:      2984 kB
VmLib:         0 kB
VmPTE:        68 kB
VmPMD:        20 kB
VmSwap:        0 kB
HugetlbPages:          0 kB
Threads:    11
SigQ:   0/31834
SigPnd: 0000000000000000
ShdPnd: 0000000000000000
SigBlk: 0000000000000000
SigIgn: 0000000000000000
SigCgt: fffffffe7fc1feff
CapInh: 0000000000000000
CapPrm: 0000003fffffffff
CapEff: 0000003fffffffff
CapBnd: 0000003fffffffff
CapAmb: 0000000000000000
Seccomp:    0
Cpus_allowed:   f
Cpus_allowed_list:  0-3
Mems_allowed:   00000000,00000001
Mems_allowed_list:  0
voluntary_ctxt_switches:    2251028
nonvoluntary_ctxt_switches: 18031
</code></pre></div><p>关于信号（signal）的信息：SigQ 分为两部分（例如 0/31834），前面表示当前处在队列中的信号（0），后面则表示队列一共可以存储多少信号（31834）；SigPnd 表示当前线程 pending 的信号，而ShdPnd 则表示整个进程 pending 的信号；SigBlk、SigIgn 和 SigCgt 分别表示对信号的处理是阻塞，忽略，还是捕获。（关于Unix信号的相关知识，可以参考 Unix: Dealing with signals）。</p>
<ul>
<li>
<p>Name:  rsyslogd 解释:进程名</p>
</li>
<li>
<p>State:  S (sleeping)</p>
<ul>
<li>
<p>解释:进程的状态我们前文已经做了很详细的分析,各进程的状态代表的意义如下:</p>
<p>R (running)&quot;, &ldquo;S (sleeping)&rdquo;, &ldquo;D (disk sleep)&rdquo;, &ldquo;T (stopped)&rdquo;, &ldquo;T(tracing stop)&rdquo;, &ldquo;Z (zombie)&rdquo;, or &ldquo;X (dead)&rdquo;</p>
</li>
</ul>
</li>
<li>
<p>Tgid:  987</p>
<p>解释:Tgid是线程组的ID,一个线程一定属于一个线程组(进程组).</p>
</li>
<li>
<p>Pid:   987</p>
<p>解释:这个是进程的ID,更准确的说应该是线程的ID.</p>
</li>
<li>
<p>PPid:  1</p>
<p>解释:当前进程的父进程</p>
</li>
<li>
<p>TracerPid:    0</p>
<p>解释:跟踪当前进程的进程ID,如果是0,表示没有跟踪.</p>
</li>
<li>
<p>Uid:   0    0    0    0</p>
<p>Gid:   0    0    0    0</p>
<p>解释:</p>
<p>第一列数字(RUID):实际用户ID,指的是进程执行者是谁.</p>
<p>第二列数字(EUID):有效用户ID,指进程执行时对文件的访问权限.</p>
<p>第三列数字(SUID):保存设置用户ID,作为effective user ID的副本,在执行exec调用时后能重新恢复原来的effectiv user ID.</p>
<p>第四列数字(FSUID):目前进程的文件系统的用户识别码.一般情况下,文件系统的用户识别码(fsuid)与有效的用户识别码(euid)是相同的.</p>
<p>这里重点说明RUID和EUID,我们用test用户启动top,如下:</p>
<p>终端1)</p>
</li>
<li>
<p>FDSize: 32</p>
<p>解释:</p>
<p>FDSize是当前分配的文件描述符,这个值不是当前进程使用文件描述符的上限.</p>
<p>我们看到这里是32,但实际并没有分配32个文件</p>
</li>
<li>
<p>Groups: 0</p>
<p>解释:</p>
<p>这里的groups表示启动这个进程的用户所在的组.</p>
</li>
<li>
<p>VmPeak:   36528 kB</p>
<p>解释:这里的VmPeak代表当前进程运行过程中占用内存的峰值.</p>
<p>我们用下面的程序申请内存,然后释放内存,最后通pause()函数中止程序的运行,</p>
</li>
<li>
<p>VmSize:   36528 kB</p>
<p>解释:VmSize代表进程现在正在占用的内存</p>
</li>
<li>
<p>VmLck:     0 kB</p>
<p>解释:VmLck代表进程已经锁住的物理内存的大小.锁住的物理内存不能交换到硬盘.</p>
</li>
<li>
<p>VmHWM:    1432 kB</p>
<p>VmRSS:    1420 kB</p>
<p>解释:</p>
<p>VmHWM是程序得到分配到物理内存的峰值.</p>
<p>VmRSS是程序现在使用的物理内存.</p>
</li>
<li>
<p>VmPTE:     56 kB</p>
<p>VmSwap:     0 kB</p>
<p>VmPTE:     56 kB</p>
<p>解释:</p>
<p>占用的页表的大小.</p>
<p>VmSwap: 0 kB</p>
</li>
</ul>
<h1 id="procself">/proc/self</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c">ssize_t <span style="color:#a6e22e">readlink</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>path, <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span>buf, size_t bufsiz);
</code></pre></div><p>/proc/self/exe 是一个符号链接，代表当前程序的绝对路径
用readlink读取/proc/self/exe可以获取当前程序的绝对路径</p>
<h1 id="demsg">demsg</h1>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">dmesg -Tx | grep <span style="color:#e6db74">&#39;Out of memory&#39;</span>
<span style="color:#75715e">#查看是否有内存溢出</span>
</code></pre></div>
    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>Jiang . </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://jfy0o0.github.io/2021/linux-note/>https://jfy0o0.github.io/2021/linux-note/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://jfy0o0.github.io/tags/linux/">
                    #Linux</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://jfy0o0.github.io">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://jfy0o0.github.io/2021/linux-errno/" class="prev" rel="prev" title="Linux - errno"><i class="iconfont icon-left"></i>&nbsp;Linux - errno</a>
         
        
        <a href="https://jfy0o0.github.io/2021/elementary-knowledge-%E5%AD%97%E7%AC%A6%E7%BC%96%E7%A0%81/" class="next" rel="next" title="elementary knowledge - 字符编码">elementary knowledge - 字符编码&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2011 - 2021</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://jfy0o0.github.io">Jiang .</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  



     </div>
  </body>
</html>
