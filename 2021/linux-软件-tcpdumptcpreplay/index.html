<!DOCTYPE html>
<html lang="en-us">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="Jiang .">
  
  
  
  <link rel="prev" href="https://jfy0o0.github.io/2021/other-docker/" />
  <link rel="next" href="https://jfy0o0.github.io/2021/linux-errno/" />
  <link rel="canonical" href="https://jfy0o0.github.io/2021/linux-%E8%BD%AF%E4%BB%B6-tcpdumptcpreplay/" />
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           Linux Soft - tcpdump、tcpreplay | Jiang . &#39;s blog
       
  </title>
  <meta name="title" content="Linux Soft - tcpdump、tcpreplay | Jiang . &#39;s blog">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/jfy0o0.github.io"
    },
    "articleSection" : "posts",
    "name" : "Linux Soft - tcpdump、tcpreplay",
    "headline" : "Linux Soft - tcpdump、tcpreplay",
    "description" : "tcpdump  根据使用者的定义对网络上的数据包进行截获的包分析工具。 tcpdump可以将网络中传送的数据包的“头”完全截获下来提供分析。 它支持针对网络层、协议、主机、网络或端口的过滤，并提供and、or、not等逻辑语句来帮助你去掉无用的信息。  tcpdump [-adeflnNOpqStvx][-c\u0026lt;数据包数目\u0026gt;][-dd][-ddd][-F\u0026lt;表达文件\u0026gt;][-i\u0026lt;网络接口\u0026gt;][-r\u0026lt;数据包文件\u0026gt;][-s\u0026lt;数据包大小\u0026gt;][-tt][-T\u0026lt;数据包类型\u0026gt;][-vv][-w\u0026lt;数据包文件\u0026gt;][输出数据栏位] 参数说明： -A 以ASCII码方式显示每一个数据包(不会显示数据包中链路层头部信息). 在抓取包含网页数据的数据包时, 可方便查看数据(nt: 即Handy for capturing web pages). -c count tcpdump将在接受到count个数据包后退出. -C file-size (nt: 此选项用于配合-w file 选项使用) 该选项使得tcpdump 在把原始数据包直接保存到文件中之前, 检查此文件大小是否超过file-size. 如果超过了, 将关闭此文件,另创一个文件继续用于原始数据包的记录. 新创建的文件名与-w 选项指定的文件名一致, 但文件名后多了一个数字.该数字会从1开始随着新创建文件的增多而增加. file-size的单位是百万字节(nt: 这里指1,000,000个字节,并非1,048,576个字节, 后者是以1024字节为1k, 1024k字节为1M计算所得, 即1M=1024 ＊ 1024 ＝ 1,048,576) -d 以容易阅读的形式,在标准输出上打印出编排过的包匹配码, 随后tcpdump停止.(nt | rt: human readable, 容易阅读的,通常是指以ascii码来打印一些信息. compiled, 编排过的. packet-matching code, 包匹配码,含义未知, 需补充) -dd 以C语言的形式打印出包匹配码. -ddd 以十进制数的形式打印出包匹配码(会在包匹配码之前有一个附加的\u0026#39;count\u0026#39;前缀). -D 打印系统中所有tcpdump可以在其上进行抓包的网络接口. 每一个接口会打印出数字编号, 相应的接口名字, 以及可能的一个网络接口描述. 其中网络接口名字和数字编号可以用在tcpdump 的-i flag 选项(nt: 把名字或数字代替flag), 来指定要在其上抓包的网络接口.",
    "inLanguage" : "en-us",
    "author" : "Jiang",
    "creator" : "Jiang",
    "publisher": "Jiang",
    "accountablePerson" : "Jiang",
    "copyrightHolder" : "Jiang",
    "copyrightYear" : "2021",
    "datePublished": "2021-05-06 15:32:33 \u002b0800 CST",
    "dateModified" : "2021-05-06 15:32:33 \u002b0800 CST",
    "url" : "https:\/\/jfy0o0.github.io\/2021\/linux-%E8%BD%AF%E4%BB%B6-tcpdumptcpreplay\/",
    "wordCount" : "752",
    "keywords" : [ "Linux Soft", "Jiang . \u0027s blog"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://jfy0o0.github.io">Jiang . &#39;s blog</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://jfy0o0.github.io">Jiang . &#39;s blog</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">
      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Linux Soft - tcpdump、tcpreplay</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://jfy0o0.github.io" rel="author">Jiang</a> with ♥ 
                <span class="post-time">
                on <time datetime=2021-05-06 itemprop="datePublished">May 6, 2021</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://jfy0o0.github.io/categories/linux-soft/"> Linux Soft </a>
                        
                </span>
        </div>
    </header>
    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          <h1 id="tcpdump">tcpdump</h1>
<ul>
<li>根据使用者的定义对网络上的数据包进行截获的包分析工具。</li>
<li>tcpdump可以将网络中传送的数据包的“头”完全截获下来提供分析。</li>
<li>它支持针对网络层、协议、主机、网络或端口的过滤，并提供and、or、not等逻辑语句来帮助你去掉无用的信息。</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">tcpdump <span style="color:#f92672">[</span>-adeflnNOpqStvx<span style="color:#f92672">][</span>-c&lt;数据包数目&gt;<span style="color:#f92672">][</span>-dd<span style="color:#f92672">][</span>-ddd<span style="color:#f92672">][</span>-F&lt;表达文件&gt;<span style="color:#f92672">][</span>-i&lt;网络接口&gt;<span style="color:#f92672">][</span>-r&lt;数据包文件&gt;<span style="color:#f92672">][</span>-s&lt;数据包大小&gt;<span style="color:#f92672">][</span>-tt<span style="color:#f92672">][</span>-T&lt;数据包类型&gt;<span style="color:#f92672">][</span>-vv<span style="color:#f92672">][</span>-w&lt;数据包文件&gt;<span style="color:#f92672">][</span>输出数据栏位<span style="color:#f92672">]</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">参数说明：

-A  以ASCII码方式显示每一个数据包<span style="color:#f92672">(</span>不会显示数据包中链路层头部信息<span style="color:#f92672">)</span>. 在抓取包含网页数据的数据包时, 可方便查看数据<span style="color:#f92672">(</span>nt: 即Handy <span style="color:#66d9ef">for</span> capturing web pages<span style="color:#f92672">)</span>.

-c  count
    tcpdump将在接受到count个数据包后退出.

-C  file-size <span style="color:#f92672">(</span>nt: 此选项用于配合-w file 选项使用<span style="color:#f92672">)</span>
    该选项使得tcpdump 在把原始数据包直接保存到文件中之前, 检查此文件大小是否超过file-size. 如果超过了, 将关闭此文件,另创一个文件继续用于原始数据包的记录. 新创建的文件名与-w 选项指定的文件名一致, 但文件名后多了一个数字.该数字会从1开始随着新创建文件的增多而增加. file-size的单位是百万字节<span style="color:#f92672">(</span>nt: 这里指1,000,000个字节,并非1,048,576个字节, 后者是以1024字节为1k, 1024k字节为1M计算所得, 即1M<span style="color:#f92672">=</span><span style="color:#ae81ff">1024</span> ＊ <span style="color:#ae81ff">1024</span> ＝ 1,048,576<span style="color:#f92672">)</span>

-d  以容易阅读的形式,在标准输出上打印出编排过的包匹配码, 随后tcpdump停止.<span style="color:#f92672">(</span>nt | rt: human readable, 容易阅读的,通常是指以ascii码来打印一些信息. compiled, 编排过的. packet-matching code, 包匹配码,含义未知, 需补充<span style="color:#f92672">)</span>

-dd 以C语言的形式打印出包匹配码.

-ddd 以十进制数的形式打印出包匹配码<span style="color:#f92672">(</span>会在包匹配码之前有一个附加的<span style="color:#e6db74">&#39;count&#39;</span>前缀<span style="color:#f92672">)</span>.

-D  打印系统中所有tcpdump可以在其上进行抓包的网络接口. 每一个接口会打印出数字编号, 相应的接口名字, 以及可能的一个网络接口描述. 其中网络接口名字和数字编号可以用在tcpdump 的-i flag 选项<span style="color:#f92672">(</span>nt: 把名字或数字代替flag<span style="color:#f92672">)</span>, 来指定要在其上抓包的网络接口.

    此选项在不支持接口列表命令的系统上很有用<span style="color:#f92672">(</span>nt: 比如, Windows 系统, 或缺乏 ifconfig -a 的UNIX系统<span style="color:#f92672">)</span>; 接口的数字编号在windows <span style="color:#ae81ff">2000</span> 或其后的系统中很有用, 因为这些系统上的接口名字比较复杂, 而不易使用.

    如果tcpdump编译时所依赖的libpcap库太老,-D 选项不会被支持, 因为其中缺乏 pcap_findalldevs<span style="color:#f92672">()</span>函数.

-e  每行的打印输出中将包括数据包的数据链路层头部信息

-E  spi@ipaddr algo:secret,...

    可通过spi@ipaddr algo:secret 来解密IPsec ESP包<span style="color:#f92672">(</span>nt | rt:IPsec Encapsulating Security Payload,IPsec 封装安全负载, IPsec可理解为, 一整套对ip数据包的加密协议, ESP 为整个IP 数据包或其中上层协议部分被加密后的数据,前者的工作模式称为隧道模式; 后者的工作模式称为传输模式 . 工作原理, 另需补充<span style="color:#f92672">)</span>.

    需要注意的是, 在终端启动tcpdump 时, 可以为IPv4 ESP packets 设置密钥<span style="color:#f92672">(</span>secret）.

    可用于加密的算法包括des-cbc, 3des-cbc, blowfish-cbc, rc3-cbc, cast128-cbc, 或者没有<span style="color:#f92672">(</span>none<span style="color:#f92672">)</span>.默认的是des-cbc<span style="color:#f92672">(</span>nt: des, Data Encryption Standard, 数据加密标准, 加密算法未知, 另需补充<span style="color:#f92672">)</span>.secret 为用于ESP 的密钥, 使用ASCII 字符串方式表达. 如果以 0x 开头, 该密钥将以16进制方式读入.

    该选项中ESP 的定义遵循RFC2406, 而不是 RFC1827. 并且, 此选项只是用来调试的, 不推荐以真实密钥<span style="color:#f92672">(</span>secret<span style="color:#f92672">)</span>来使用该选项, 因为这样不安全: 在命令行中输入的secret 可以被其他人通过ps 等命令查看到.

    除了以上的语法格式<span style="color:#f92672">(</span>nt: 指spi@ipaddr algo:secret<span style="color:#f92672">)</span>, 还可以在后面添加一个语法输入文件名字供tcpdump 使用<span style="color:#f92672">(</span>nt：即把spi@ipaddr algo:secret,... 中...换成一个语法文件名<span style="color:#f92672">)</span>. 此文件在接受到第一个ESP　包时会打开此文件, 所以最好此时把赋予tcpdump 的一些特权取消<span style="color:#f92672">(</span>nt: 可理解为, 这样防范之后, 当该文件为恶意编写时,不至于造成过大损害<span style="color:#f92672">)</span>.

-f  显示外部的IPv4 地址时<span style="color:#f92672">(</span>nt: foreign IPv4 addresses, 可理解为, 非本机ip地址<span style="color:#f92672">)</span>, 采用数字方式而不是名字.<span style="color:#f92672">(</span>此选项是用来对付Sun公司的NIS服务器的缺陷<span style="color:#f92672">(</span>nt: NIS, 网络信息服务, tcpdump 显示外部地址的名字时会用到她提供的名称服务<span style="color:#f92672">)</span>: 此NIS服务器在查询非本地地址名字时,常常会陷入无尽的查询循环<span style="color:#f92672">)</span>.

    由于对外部<span style="color:#f92672">(</span>foreign<span style="color:#f92672">)</span>IPv4地址的测试需要用到本地网络接口<span style="color:#f92672">(</span>nt: tcpdump 抓包时用到的接口<span style="color:#f92672">)</span>及其IPv4 地址和网络掩码. 如果此地址或网络掩码不可用, 或者此接口根本就没有设置相应网络地址和网络掩码<span style="color:#f92672">(</span>nt: linux 下的 <span style="color:#e6db74">&#39;any&#39;</span> 网络接口就不需要设置地址和掩码, 不过此<span style="color:#e6db74">&#39;any&#39;</span>接口可以收到系统中所有接口的数据包<span style="color:#f92672">)</span>, 该选项不能正常工作.

-F  file
    使用file 文件作为过滤条件表达式的输入, 此时命令行上的输入将被忽略.

-i  interface

    指定tcpdump 需要监听的接口.  如果没有指定, tcpdump 会从系统接口列表中搜寻编号最小的已配置好的接口<span style="color:#f92672">(</span>不包括 loopback 接口<span style="color:#f92672">)</span>.一但找到第一个符合条件的接口, 搜寻马上结束.

    在采用2.2版本或之后版本内核的Linux 操作系统上, <span style="color:#e6db74">&#39;any&#39;</span> 这个虚拟网络接口可被用来接收所有网络接口上的数据包<span style="color:#f92672">(</span>nt: 这会包括目的是该网络接口的, 也包括目的不是该网络接口的<span style="color:#f92672">)</span>. 需要注意的是如果真实网络接口不能工作在<span style="color:#e6db74">&#39;混杂&#39;</span>模式<span style="color:#f92672">(</span>promiscuous<span style="color:#f92672">)</span>下,则无法在<span style="color:#e6db74">&#39;any&#39;</span>这个虚拟的网络接口上抓取其数据包.

    如果 -D 标志被指定, tcpdump会打印系统中的接口编号，而该编号就可用于此处的interface 参数.

-l  对标准输出进行行缓冲<span style="color:#f92672">(</span>nt: 使标准输出设备遇到一个换行符就马上把这行的内容打印出来<span style="color:#f92672">)</span>.在需要同时观察抓包打印以及保存抓包记录的时候很有用. 比如, 可通过以下命令组合来达到此目的:
    <span style="color:#e6db74">``</span>tcpdump  -l  |  tee dat<span style="color:#e6db74">&#39;&#39;</span> 或者 <span style="color:#e6db74">``</span>tcpdump  -l   &gt; dat  &amp;  tail  -f  dat<span style="color:#e6db74">&#39;&#39;</span>.<span style="color:#f92672">(</span>nt: 前者使用tee来把tcpdump 的输出同时放到文件dat和标准输出中, 而后者通过重定向操作<span style="color:#e6db74">&#39;&gt;&#39;</span>, 把tcpdump的输出放到dat 文件中, 同时通过tail把dat文件中的内容放到标准输出中<span style="color:#f92672">)</span>

-L  列出指定网络接口所支持的数据链路层的类型后退出.<span style="color:#f92672">(</span>nt: 指定接口通过-i 来指定<span style="color:#f92672">)</span>

-m  module
    通过module 指定的file 装载SMI MIB 模块<span style="color:#f92672">(</span>nt: SMI，Structure of Management Information, 管理信息结构MIB, Management Information Base, 管理信息库. 可理解为, 这两者用于SNMP<span style="color:#f92672">(</span>Simple Network Management Protoco<span style="color:#f92672">)</span>协议数据包的抓取. 具体SNMP 的工作原理未知, 另需补充<span style="color:#f92672">)</span>.

    此选项可多次使用, 从而为tcpdump 装载不同的MIB 模块.

-M  secret  如果TCP 数据包<span style="color:#f92672">(</span>TCP segments<span style="color:#f92672">)</span>有TCP-MD5选项<span style="color:#f92672">(</span>在RFC 2385有相关描述<span style="color:#f92672">)</span>, 则为其摘要的验证指定一个公共的密钥secret.

-n  不对地址<span style="color:#f92672">(</span>比如, 主机地址, 端口号<span style="color:#f92672">)</span>进行数字表示到名字表示的转换.

-N  不打印出host 的域名部分. 比如, 如果设置了此选现, tcpdump 将会打印<span style="color:#e6db74">&#39;nic&#39;</span> 而不是 <span style="color:#e6db74">&#39;nic.ddn.mil&#39;</span>.

-O  不启用进行包匹配时所用的优化代码. 当怀疑某些bug是由优化代码引起的, 此选项将很有用.

-p  一般情况下, 把网络接口设置为非<span style="color:#e6db74">&#39;混杂&#39;</span>模式. 但必须注意 , 在特殊情况下此网络接口还是会以<span style="color:#e6db74">&#39;混杂&#39;</span>模式来工作； 从而, <span style="color:#e6db74">&#39;-p&#39;</span> 的设与不设, 不能当做以下选现的代名词:<span style="color:#e6db74">&#39;ether host {local-hw-add}&#39;</span> 或  <span style="color:#e6db74">&#39;ether broadcast&#39;</span><span style="color:#f92672">(</span>nt: 前者表示只匹配以太网地址为host 的包, 后者表示匹配以太网地址为广播地址的数据包<span style="color:#f92672">)</span>.

-q  快速<span style="color:#f92672">(</span>也许用<span style="color:#e6db74">&#39;安静&#39;</span>更好?<span style="color:#f92672">)</span>打印输出. 即打印很少的协议相关信息, 从而输出行都比较简短.

-R  设定tcpdump 对 ESP/AH 数据包的解析按照 RFC1825而不是RFC1829<span style="color:#f92672">(</span>nt: AH, 认证头, ESP， 安全负载封装, 这两者会用在IP包的安全传输机制中<span style="color:#f92672">)</span>. 如果此选项被设置, tcpdump 将不会打印出<span style="color:#e6db74">&#39;禁止中继&#39;</span>域<span style="color:#f92672">(</span>nt: relay prevention field<span style="color:#f92672">)</span>. 另外,由于ESP/AH规范中没有规定ESP/AH数据包必须拥有协议版本号域,所以tcpdump不能从收到的ESP/AH数据包中推导出协议版本号.

-r  file
    从文件file 中读取包数据. 如果file 字段为 <span style="color:#e6db74">&#39;-&#39;</span> 符号, 则tcpdump 会从标准输入中读取包数据.

-S  打印TCP 数据包的顺序号时, 使用绝对的顺序号, 而不是相对的顺序号.<span style="color:#f92672">(</span>nt: 相对顺序号可理解为, 相对第一个TCP 包顺序号的差距,比如, 接受方收到第一个数据包的绝对顺序号为232323, 对于后来接收到的第2个,第3个数据包, tcpdump会打印其序列号为1, 2分别表示与第一个数据包的差距为1 和 2. 而如果此时-S 选项被设置, 对于后来接收到的第2个, 第3个数据包会打印出其绝对顺序号:232324, 232325<span style="color:#f92672">)</span>.

-s  snaplen
    设置tcpdump的数据包抓取长度为snaplen, 如果不设置默认将会是68字节<span style="color:#f92672">(</span>而支持网络接口分接头<span style="color:#f92672">(</span>nt: NIT, 上文已有描述,可搜索<span style="color:#e6db74">&#39;网络接口分接头&#39;</span>关键字找到那里<span style="color:#f92672">)</span>的SunOS系列操作系统中默认的也是最小值是96<span style="color:#f92672">)</span>.68字节对于IP, ICMP<span style="color:#f92672">(</span>nt: Internet Control Message Protocol,因特网控制报文协议<span style="color:#f92672">)</span>, TCP 以及 UDP 协议的报文已足够, 但对于名称服务<span style="color:#f92672">(</span>nt: 可理解为dns, nis等服务<span style="color:#f92672">)</span>, NFS服务相关的数据包会产生包截短. 如果产生包截短这种情况, tcpdump的相应打印输出行中会出现<span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">[</span>|proto<span style="color:#f92672">]</span><span style="color:#e6db74">&#39;&#39;</span>的标志（proto 实际会显示为被截短的数据包的相关协议层次<span style="color:#f92672">)</span>. 需要注意的是, 采用长的抓取长度<span style="color:#f92672">(</span>nt: snaplen比较大<span style="color:#f92672">)</span>, 会增加包的处理时间, 并且会减少tcpdump 可缓存的数据包的数量， 从而会导致数据包的丢失. 所以, 在能抓取我们想要的包的前提下, 抓取长度越小越好.把snaplen 设置为0 意味着让tcpdump自动选择合适的长度来抓取数据包.

-T  type
    强制tcpdump按type指定的协议所描述的包结构来分析收到的数据包.  目前已知的type 可取的协议为:
    aodv <span style="color:#f92672">(</span>Ad-hoc On-demand Distance Vector protocol, 按需距离向量路由协议, 在Ad hoc<span style="color:#f92672">(</span>点对点模式<span style="color:#f92672">)</span>网络中使用<span style="color:#f92672">)</span>,
    cnfp <span style="color:#f92672">(</span>Cisco  NetFlow  protocol<span style="color:#f92672">)</span>,  rpc<span style="color:#f92672">(</span>Remote Procedure Call<span style="color:#f92672">)</span>, rtp <span style="color:#f92672">(</span>Real-Time Applications protocol<span style="color:#f92672">)</span>,
    rtcp <span style="color:#f92672">(</span>Real-Time Applications con-trol protocol<span style="color:#f92672">)</span>, snmp <span style="color:#f92672">(</span>Simple Network Management Protocol<span style="color:#f92672">)</span>,
    tftp <span style="color:#f92672">(</span>Trivial File Transfer Protocol, 碎文件协议<span style="color:#f92672">)</span>, vat <span style="color:#f92672">(</span>Visual Audio Tool, 可用于在internet 上进行电
    视电话会议的应用层协议<span style="color:#f92672">)</span>, 以及wb <span style="color:#f92672">(</span>distributed White Board, 可用于网络会议的应用层协议<span style="color:#f92672">)</span>.

-t     在每行输出中不打印时间戳

-tt    不对每行输出的时间进行格式处理<span style="color:#f92672">(</span>nt: 这种格式一眼可能看不出其含义, 如时间戳打印成1261798315<span style="color:#f92672">)</span>

-ttt   tcpdump 输出时, 每两行打印之间会延迟一个段时间<span style="color:#f92672">(</span>以毫秒为单位<span style="color:#f92672">)</span>

-tttt  在每行打印的时间戳之前添加日期的打印

-u     打印出未加密的NFS 句柄<span style="color:#f92672">(</span>nt: handle可理解为NFS 中使用的文件句柄, 这将包括文件夹和文件夹中的文件<span style="color:#f92672">)</span>

-U    使得当tcpdump在使用-w 选项时, 其文件写入与包的保存同步.<span style="color:#f92672">(</span>nt: 即, 当每个数据包被保存时, 它将及时被写入文件中,而不是等文件的输出缓冲已满时才真正写入此文件<span style="color:#f92672">)</span>

      -U 标志在老版本的libcap库<span style="color:#f92672">(</span>nt: tcpdump 所依赖的报文捕获库<span style="color:#f92672">)</span>上不起作用, 因为其中缺乏pcap_cump_flush<span style="color:#f92672">()</span>函数.

-v    当分析和打印的时候, 产生详细的输出. 比如, 包的生存时间, 标识, 总长度以及IP包的一些选项. 这也会打开一些附加的包完整性检测, 比如对IP或ICMP包头部的校验和.

-vv   产生比-v更详细的输出. 比如, NFS回应包中的附加域将会被打印, SMB数据包也会被完全解码.

-vvv  产生比-vv更详细的输出. 比如, telent 时所使用的SB, SE 选项将会被打印, 如果telnet同时使用的是图形界面,
      其相应的图形选项将会以16进制的方式打印出来<span style="color:#f92672">(</span>nt: telnet 的SB,SE选项含义未知, 另需补充<span style="color:#f92672">)</span>.

-w    把包数据直接写入文件而不进行分析和打印输出. 这些包数据可在随后通过-r 选项来重新读入并进行分析和打印.

-W    filecount
      此选项与-C 选项配合使用, 这将限制可打开的文件数目, 并且当文件数据超过这里设置的限制时, 依次循环替代之前的文件, 这相当于一个拥有filecount 个文件的文件缓冲池. 同时, 该选项会使得每个文件名的开头会出现足够多并用来占位的0, 这可以方便这些文件被正确的排序.

-x    当分析和打印时, tcpdump 会打印每个包的头部数据, 同时会以16进制打印出每个包的数据<span style="color:#f92672">(</span>但不包括连接层的头部<span style="color:#f92672">)</span>.总共打印的数据大小不会超过整个数据包的大小与snaplen 中的最小值. 必须要注意的是, 如果高层协议数据没有snaplen 这么长,并且数据链路层<span style="color:#f92672">(</span>比如, Ethernet层<span style="color:#f92672">)</span>有填充数据, 则这些填充数据也会被打印.<span style="color:#f92672">(</span>nt: so <span style="color:#66d9ef">for</span> link  layers  that pad, 未能衔接理解和翻译, 需补充 <span style="color:#f92672">)</span>

-xx   tcpdump 会打印每个包的头部数据, 同时会以16进制打印出每个包的数据, 其中包括数据链路层的头部.

-X    当分析和打印时, tcpdump 会打印每个包的头部数据, 同时会以16进制和ASCII码形式打印出每个包的数据<span style="color:#f92672">(</span>但不包括连接层的头部<span style="color:#f92672">)</span>.这对于分析一些新协议的数据包很方便.

-XX   当分析和打印时, tcpdump 会打印每个包的头部数据, 同时会以16进制和ASCII码形式打印出每个包的数据, 其中包括数据链路层的头部.这对于分析一些新协议的数据包很方便.

-y    datalinktype
      设置tcpdump 只捕获数据链路层协议类型是datalinktype的数据包

-Z    user
      使tcpdump 放弃自己的超级权限<span style="color:#f92672">(</span>如果以root用户启动tcpdump, tcpdump将会有超级用户权限<span style="color:#f92672">)</span>, 并把当前tcpdump的用户ID设置为user, 组ID设置为user首要所属组的ID<span style="color:#f92672">(</span>nt: tcpdump 此处可理解为tcpdump 运行之后对应的进程<span style="color:#f92672">)</span>
</code></pre></div><p><strong>监视指定主机和端口的数据包</strong></p>
<p>如果想要获取主机210.27.48.1接收或发出的telnet包，使用如下命令</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">tcpdump -i eno1 tcp port <span style="color:#ae81ff">23</span> and host 210.27.48.1
</code></pre></div><p>对本机的udp 123 端口进行监视 123 为ntp的服务端口</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">tcpdump udp port <span style="color:#ae81ff">123</span> 
</code></pre></div><p><strong>监视指定协议的数据包</strong></p>
<p>打印TCP会话中的的开始和结束数据包, 并且数据包的源或目的不是本地网络上的主机.(nt: localnet, 实际使用时要真正替换成本地网络的名字))</p>
<pre><code>tcpdump 'tcp[tcpflags] &amp; (tcp-syn|tcp-fin) != 0 and not src and dst net localnet'
</code></pre><p>打印所有源或目的端口是80, 网络层协议为IPv4, 并且含有数据,而不是SYN,FIN以及ACK-only等不含数据的数据包.(ipv6的版本的表达式可做练习)</p>
<pre><code>tcpdump 'tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)'
</code></pre><p>(nt: 可理解为, ip[2:2]表示整个ip数据包的长度, (ip[0]&amp;0xf)&laquo;2)表示ip数据包包头的长度(ip[0]&amp;0xf代表包中的IHL域, 而此域的单位为32bit, 要换算</p>
<p>成字节数需要乘以4,　即左移2.　(tcp[12]&amp;0xf0)&raquo;4 表示tcp头的长度, 此域的单位也是32bit,　换算成比特数为 ((tcp[12]&amp;0xf0) &raquo; 4)　&laquo;　２,　
即 ((tcp[12]&amp;0xf0)&raquo;2).　((ip[2:2] - ((ip[0]&amp;0xf)&laquo;2)) - ((tcp[12]&amp;0xf0)&raquo;2)) != 0　表示: 整个ip数据包的长度减去ip头的长度,再减去
tcp头的长度不为0, 这就意味着, ip数据包中确实是有数据.对于ipv6版本只需考虑ipv6头中的&rsquo;Payload Length' 与 &lsquo;tcp头的长度&rsquo;的差值, 并且其中表达方式&rsquo;ip[]&lsquo;需换成&rsquo;ip6[]&rsquo;.)</p>
<h1 id="tcpreplay">tcpreplay</h1>
<ul>
<li>用于重放保存在pcap文件中的网络流量</li>
<li>它支持按照捕获pcap文件时数据包的速度、或者指定速度去重放网络流量，只要在硬件承受的范围内即可。</li>
<li>它可以根据需要，使流量可以在两个网卡直接拆分、写入文件、进行筛选、以各种方式进行编辑，从而为测试防火墙、NIDS和其他网络设备提供了方法。</li>
</ul>
<p><strong>tcpreplay</strong> [<strong>-flags</strong>] [<strong>-flag</strong> [<em>value</em>]] [<strong>&ndash;option-name</strong>[[=| ]<em>value</em>]] &lt;pcap_file(s)&gt;</p>
<ul>
<li>命令参数：</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">-A <span style="color:#e6db74">&#34;&#34;</span> 在使用 tcpdump 风格打印输出信息时，同时再调用tcpdump中的参数， 默认已经带有“-n,-l”，所以一般看到的都是ip地址，而没有主机名的打印，注意这个是在tcpreplay使用了-v参数时才能使用，不带-v不会报错，但是没有实际意义。格式：-vA “nnt”表示以tcpdump风格输出报文信息，并且不打印时间戳、主机名、端口服务名称。注意不要使用-c参数来指定打印的数据报文的个数，这样发送出去的报文也会变少。 
-c 双网卡回放报文必选参数，后面紧跟cache文件名，该文件为tcpprep根据对应的pcap文件构造出来。 
-D 把应用层的数据，使用dump mode写入到指定文件中去，和-w、-W 参数一起使用。 
-e 指定端点的ip，即把发送报文的和接收的报文的ip都修改称对应的参数值中指定的ip，但是这样发送的出的报文不会区分client和server。。 
-f 指定配置文件。 
-F 在发送报文时，自动纠正错误的校验和。对测试DUT的校验和检验。 
-h 显示帮助文件。 
-i 双网卡回放报文必选参数，指定主接口。 
-I 重写主网卡发送出报文的目的MAC地址。 
-j 双网卡回放报文必选参数，指定从接口。 
-J 重写从网卡发送出报文的目的MAC地址。
-k 重写主网卡发送报文的源MAC地址。
-K 重写从网卡发送报文的源MAC地址。 
-l 指定循环的次数。 
-L 指定最大的发包数量。可以在确认连接的调试时使用。 
-m 指定一个倍数值，就是必默认发送速率要快多少倍的速率发送报文。 加大发送的速率后，对于DUT可能意味着有更多的并发连接和连接数，特别是对于BT报文的重放， 因为连接的超时是固定的，如果速率增大的话， 留在session表中的连接数量增大，还可以通过修改连接的超时时间来达到该目的。 
-M 表示不发送“火星”的ip报文，man文件中的定义是 0/8、172/8、 255/8。 
-n 在使用-S参数，不对混杂模式进行侦听。 
-N 通过伪造的NAT，重写IP地址。这个参数应该有很重要的应用，目前没有测试使用。 
-O 没有测试使用。 
-p 指定每秒发送报文的个数，指定该参数，其它速率相关的参数被忽略，最后的打印信息不会有速率和每秒发送报文的统计。 
-P 表示在输出信息中打印PID的信息，用于单用户或单帐户模式下暂停和重启程序。 
-r 指定发送的速率。目前-m/-r/-p这3个参数的相互关系。 
-R 让网卡极限速度发数据包。 
-t 指定MTU，标准的10/100M网卡的默认值是1500。 
-T Truncate packets &gt; 截去报文中MTU大于标准值的部分再发送出去，默认是不发送，skip掉。 
-v 每发送一个报文都以 tcpdump 的风格打印出对应的信息。 -V 查看版本号。 
-w 将主网卡发送的报文写入一个文件中，参数后紧跟文件名。

</code></pre></div>
    </div>

    <div class="post-copyright">
             
            <p class="copyright-item">
                <span>Author:</span>
                <span>Jiang . </span>
                </p>
            
           
             
            <p class="copyright-item">
                    <span>Link:</span>
                    <a href=https://jfy0o0.github.io/2021/linux-%E8%BD%AF%E4%BB%B6-tcpdumptcpreplay/>https://jfy0o0.github.io/2021/linux-%E8%BD%AF%E4%BB%B6-tcpdumptcpreplay/</span>
            </p>
            
             
            <p class="copyright-item lincese">
                本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://jfy0o0.github.io/tags/linux-soft/">
                    #Linux Soft</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://jfy0o0.github.io">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://jfy0o0.github.io/2021/other-docker/" class="prev" rel="prev" title="Other - docker"><i class="iconfont icon-left"></i>&nbsp;Other - docker</a>
         
        
        <a href="https://jfy0o0.github.io/2021/linux-errno/" class="next" rel="next" title="Linux - errno">Linux - errno&nbsp;<i class="iconfont icon-right"></i></a>
        
    </div>

    <div class="post-comment">
          
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2011 - 2021</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://jfy0o0.github.io">Jiang .</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  



     </div>
  </body>
</html>
